<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aula 15 - Autentica√ß√£o e Autoriza√ß√£o | Desenvolvimento Web - UNINOVE</title>
    <link rel="stylesheet" href="css/slides.css">
</head>
<body>
    <div class="presentation">

        <!-- SLIDE 1: Capa -->
        <div class="slide slide-cover active">
            <h1>Desenvolvimento Web</h1>
            <h2>Aula 15 ‚Äî Autentica√ß√£o e Autoriza√ß√£o</h2>
            <p>Login, Registro, Hashing e [Authorize]</p>
            <p style="margin-top: 30px; font-size: 0.9em; color: rgba(255,255,255,0.5);">2026.1 ‚Äî 120 minutos</p>
        </div>

        <!-- SLIDE 2: Recapitula√ß√£o -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Recapitula√ß√£o ‚Äî Aula 14</h2></div>
            <div class="slide-body">
                <div class="recap-container">
                    <h3>O que vimos na aula passada</h3>
                    <ul class="recap-items">
                        <li class="recap-item"><strong>AJAX:</strong> Requisi√ß√µes em segundo plano ‚Äî sem recarregar a p√°gina</li>
                        <li class="recap-item"><strong>JSON:</strong> Formato padr√£o para troca de dados na web</li>
                        <li class="recap-item"><strong>fetch():</strong> API do JavaScript para enviar requisi√ß√µes GET e POST</li>
                        <li class="recap-item"><strong>Json():</strong> M√©todo do Controller que retorna dados em JSON</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- SLIDE 3: Agenda -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Agenda</h2></div>
            <div class="slide-body">
                <ul class="agenda-list">
                    <li>Autentica√ß√£o vs. Autoriza√ß√£o</li>
                    <li>Hashing de Senhas com BCrypt</li>
                    <li>Model de Usu√°rio</li>
                    <li>Mini Quiz</li>
                    <li>Registro e Login</li>
                    <li>Protegendo Rotas com [Authorize]</li>
                    <li>Caso de Uso Real: Netflix</li>
                    <li>Exerc√≠cio Guiado: Sistema de Login</li>
                </ul>
            </div>
        </div>

        <!-- SLIDE 4: Autentica√ß√£o vs Autoriza√ß√£o -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Autentica√ß√£o vs. Autoriza√ß√£o</h2></div>
            <div class="slide-body">
                <div class="concept-cards two-cols" style="margin-top: 10px;">
                    <div class="concept-card" style="border-left: 4px solid #1565C0;">
                        <span class="card-icon">üîë</span>
                        <h4>Autentica√ß√£o</h4>
                        <p><strong>"Quem √© voc√™?"</strong></p>
                        <p>Verificar a identidade do usu√°rio (login/senha)</p>
                    </div>
                    <div class="concept-card" style="border-left: 4px solid #2E7D32;">
                        <span class="card-icon">üõ°Ô∏è</span>
                        <h4>Autoriza√ß√£o</h4>
                        <p><strong>"O que voc√™ pode fazer?"</strong></p>
                        <p>Verificar se tem permiss√£o para acessar um recurso</p>
                    </div>
                </div>
                <div class="analogy-box" style="margin-top: 15px;">
                    <span class="analogy-icon">üè¢</span>
                    <div class="analogy-text">
                        <h4>Analogia: Pr√©dio Corporativo</h4>
                        <p><strong>Autentica√ß√£o</strong> = crach√° que te identifica na portaria. <strong>Autoriza√ß√£o</strong> = permiss√£o para entrar em determinados andares. Voc√™ pode ser identificado (autenticado), mas n√£o ter acesso ao andar da diretoria (n√£o autorizado).</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SLIDE 5: Hashing -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Hashing de Senhas</h2></div>
            <div class="slide-body">
                <p>Nunca armazene senhas em texto puro! Use <strong>hashing</strong> ‚Äî uma fun√ß√£o que transforma a senha em um valor irrevers√≠vel.</p>
                <pre>
<span class="comment"># Instalar o pacote BCrypt</span>
dotnet add package BCrypt.Net-Next

<span class="comment">// Gerar hash da senha</span>
<span class="keyword">string</span> <span class="js-var">senhaHash</span> = BCrypt.Net.BCrypt.<span class="js-func">HashPassword</span>(<span class="js-string">"minhasenha123"</span>);
<span class="comment">// Resultado: "$2a$11$K3GG..."</span>

<span class="comment">// Verificar a senha</span>
<span class="keyword">bool</span> <span class="js-var">valida</span> = BCrypt.Net.BCrypt.<span class="js-func">Verify</span>(<span class="js-string">"minhasenha123"</span>, <span class="js-var">senhaHash</span>);
<span class="comment">// true</span></pre>
                <div class="diagram-flow" style="margin-top: 10px; justify-content: center;">
                    <div class="diagram-box" style="min-width: 120px;">
                        <span class="box-label">Senha</span>
                        <span class="box-desc">"minhasenha123"</span>
                    </div>
                    <span class="diagram-arrow">‚Üí</span>
                    <div class="diagram-box highlight" style="min-width: 120px;">
                        <span class="box-label">BCrypt</span>
                        <span class="box-desc">Hash irrevers√≠vel</span>
                    </div>
                    <span class="diagram-arrow">‚Üí</span>
                    <div class="diagram-box highlight-coral" style="min-width: 130px;">
                        <span class="box-label">Banco de Dados</span>
                        <span class="box-desc">"$2a$11$K3GG..."</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SLIDE 6: Mini Quiz (meio) -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Mini Quiz</h2></div>
            <div class="slide-body" style="justify-content: center;">
                <div class="quiz-container" data-answer="c">
                    <h3>Vamos verificar!</h3>
                    <p class="quiz-question">Por que usamos <strong>hashing</strong> para armazenar senhas?</p>
                    <ul class="quiz-options">
                        <li><button class="quiz-option" data-option="a">a) Para comprimir a senha e economizar espa√ßo</button></li>
                        <li><button class="quiz-option" data-option="b">b) Para criptografar e depois descriptografar</button></li>
                        <li><button class="quiz-option" data-option="c">c) Para transformar em valor irrevers√≠vel ‚Äî se o banco vazar, a senha real n√£o √© exposta</button></li>
                        <li><button class="quiz-option" data-option="d">d) Para acelerar a verifica√ß√£o de login</button></li>
                    </ul>
                    <div class="quiz-feedback">A resposta correta √© <strong>(c)</strong>. Hashing √© uma fun√ß√£o <strong>irrevers√≠vel</strong>. Mesmo que o banco de dados seja comprometido, as senhas reais n√£o podem ser recuperadas.</div>
                </div>
            </div>
        </div>

        <!-- SLIDE 7: Model de Usu√°rio -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Model de Usu√°rio</h2></div>
            <div class="slide-body">
                <pre>
<span class="comment">// Models/Usuario.cs</span>
<span class="keyword">public class</span> <span class="type">Usuario</span>
{
    <span class="keyword">public int</span> Id { <span class="keyword">get</span>; <span class="keyword">set</span>; }

    [<span class="type">Required</span>(ErrorMessage = <span class="js-string">"Nome obrigat√≥rio"</span>)]
    <span class="keyword">public string</span> Nome { <span class="keyword">get</span>; <span class="keyword">set</span>; } = <span class="js-string">""</span>;

    [<span class="type">Required</span>]
    [<span class="type">EmailAddress</span>]
    <span class="keyword">public string</span> Email { <span class="keyword">get</span>; <span class="keyword">set</span>; } = <span class="js-string">""</span>;

    [<span class="type">Required</span>]
    <span class="keyword">public string</span> SenhaHash { <span class="keyword">get</span>; <span class="keyword">set</span>; } = <span class="js-string">""</span>;

    <span class="keyword">public string</span> Perfil { <span class="keyword">get</span>; <span class="keyword">set</span>; } = <span class="js-string">"Usuario"</span>;
}

<span class="comment">// Adicionar ao DbContext</span>
<span class="keyword">public</span> DbSet&lt;<span class="type">Usuario</span>&gt; Usuarios { <span class="keyword">get</span>; <span class="keyword">set</span>; }</pre>
            </div>
        </div>

        <!-- SLIDE 8: Registro -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Registro de Usu√°rio</h2></div>
            <div class="slide-body">
                <pre>
[<span class="type">HttpPost</span>]
<span class="keyword">public</span> <span class="type">IActionResult</span> <span class="js-func">Registrar</span>(<span class="keyword">string</span> <span class="js-var">nome</span>, <span class="keyword">string</span> <span class="js-var">email</span>, <span class="keyword">string</span> <span class="js-var">senha</span>)
{
    <span class="comment">// Verificar se e-mail j√° existe</span>
    <span class="keyword">if</span> (_context.Usuarios.<span class="js-func">Any</span>(u => u.Email == <span class="js-var">email</span>))
    {
        ViewBag.Erro = <span class="js-string">"E-mail j√° cadastrado!"</span>;
        <span class="keyword">return</span> <span class="js-func">View</span>();
    }

    <span class="keyword">var</span> <span class="js-var">usuario</span> = <span class="keyword">new</span> <span class="type">Usuario</span>
    {
        Nome = <span class="js-var">nome</span>,
        Email = <span class="js-var">email</span>,
        SenhaHash = BCrypt.Net.BCrypt.<span class="js-func">HashPassword</span>(<span class="js-var">senha</span>)
    };

    _context.Usuarios.<span class="js-func">Add</span>(<span class="js-var">usuario</span>);
    _context.<span class="js-func">SaveChanges</span>();
    <span class="keyword">return</span> <span class="js-func">RedirectToAction</span>(<span class="js-string">"Login"</span>);
}</pre>
            </div>
        </div>

        <!-- SLIDE 9: Login -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Login com Cookie Authentication</h2></div>
            <div class="slide-body">
                <pre style="font-size: 0.85em;">
[<span class="type">HttpPost</span>]
<span class="keyword">public async</span> Task&lt;<span class="type">IActionResult</span>&gt; <span class="js-func">Login</span>(<span class="keyword">string</span> <span class="js-var">email</span>, <span class="keyword">string</span> <span class="js-var">senha</span>)
{
    <span class="keyword">var</span> <span class="js-var">usuario</span> = _context.Usuarios
        .<span class="js-func">FirstOrDefault</span>(u => u.Email == <span class="js-var">email</span>);

    <span class="keyword">if</span> (<span class="js-var">usuario</span> == <span class="keyword">null</span> || 
        !BCrypt.Net.BCrypt.<span class="js-func">Verify</span>(<span class="js-var">senha</span>, <span class="js-var">usuario</span>.SenhaHash))
    {
        ViewBag.Erro = <span class="js-string">"E-mail ou senha inv√°lidos!"</span>;
        <span class="keyword">return</span> <span class="js-func">View</span>();
    }

    <span class="comment">// Criar claims (informa√ß√µes do usu√°rio)</span>
    <span class="keyword">var</span> <span class="js-var">claims</span> = <span class="keyword">new</span> List&lt;Claim&gt;
    {
        <span class="keyword">new</span> Claim(ClaimTypes.Name, <span class="js-var">usuario</span>.Nome),
        <span class="keyword">new</span> Claim(ClaimTypes.Email, <span class="js-var">usuario</span>.Email),
        <span class="keyword">new</span> Claim(ClaimTypes.Role, <span class="js-var">usuario</span>.Perfil)
    };
    <span class="keyword">var</span> <span class="js-var">identity</span> = <span class="keyword">new</span> ClaimsIdentity(<span class="js-var">claims</span>, <span class="js-string">"CookieAuth"</span>);
    <span class="keyword">var</span> <span class="js-var">principal</span> = <span class="keyword">new</span> ClaimsPrincipal(<span class="js-var">identity</span>);

    <span class="keyword">await</span> HttpContext.<span class="js-func">SignInAsync</span>(<span class="js-string">"CookieAuth"</span>, <span class="js-var">principal</span>);
    <span class="keyword">return</span> <span class="js-func">RedirectToAction</span>(<span class="js-string">"Index"</span>, <span class="js-string">"Home"</span>);
}</pre>
            </div>
        </div>

        <!-- SLIDE 10: [Authorize] -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Protegendo Rotas com [Authorize]</h2></div>
            <div class="slide-body">
                <pre>
<span class="comment">// Proteger uma Action espec√≠fica</span>
[<span class="type">Authorize</span>]
<span class="keyword">public</span> <span class="type">IActionResult</span> <span class="js-func">Painel</span>()
{
    <span class="keyword">var</span> <span class="js-var">nome</span> = User.Identity.Name;
    <span class="keyword">return</span> <span class="js-func">View</span>();
}

<span class="comment">// Proteger todo o Controller</span>
[<span class="type">Authorize</span>]
<span class="keyword">public class</span> <span class="type">AdminController</span> : <span class="type">Controller</span> { }

<span class="comment">// Permitir acesso an√¥nimo em Controller protegido</span>
[<span class="type">AllowAnonymous</span>]
<span class="keyword">public</span> <span class="type">IActionResult</span> <span class="js-func">Login</span>() => <span class="js-func">View</span>();

<span class="comment">// Exigir perfil espec√≠fico</span>
[<span class="type">Authorize</span>(Roles = <span class="js-string">"Admin"</span>)]
<span class="keyword">public</span> <span class="type">IActionResult</span> <span class="js-func">GerenciarUsuarios</span>() => <span class="js-func">View</span>();</pre>
                <div class="box-info" style="margin-top: 10px;">
                    <p>Se o usu√°rio n√£o estiver autenticado, o ASP.NET redireciona automaticamente para a p√°gina de login.</p>
                </div>
            </div>
        </div>

        <!-- SLIDE 11: Caso de Uso Real -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Caso de Uso Real</h2></div>
            <div class="slide-body">
                <div class="real-world">
                    <h3>Netflix ‚Äî Autentica√ß√£o e Perfis</h3>
                    <span class="company-tag">Netflix</span>
                    <span class="company-tag">Autentica√ß√£o</span>
                    <span class="company-tag">Autoriza√ß√£o</span>
                    <p style="margin-top: 10px;">A Netflix usa <strong>autentica√ß√£o</strong> para verificar se voc√™ √© assinante (login). Depois, usa <strong>autoriza√ß√£o</strong> para definir o que voc√™ pode assistir (plano b√°sico vs. premium, conte√∫do por regi√£o, perfil infantil).</p>
                </div>
                <div class="concept-cards" style="margin-top: 10px;">
                    <div class="concept-card">
                        <span class="card-icon">üîë</span>
                        <h4>Autentica√ß√£o</h4>
                        <p>Login com e-mail e senha</p>
                    </div>
                    <div class="concept-card">
                        <span class="card-icon">üë§</span>
                        <h4>Perfis</h4>
                        <p>Cada perfil tem suas prefer√™ncias</p>
                    </div>
                    <div class="concept-card">
                        <span class="card-icon">üõ°Ô∏è</span>
                        <h4>Autoriza√ß√£o</h4>
                        <p>Plano define qualidade e telas</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SLIDE 12: Exerc√≠cio Guiado -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Exerc√≠cio Guiado</h2></div>
            <div class="slide-body">
                <div class="guided-exercise">
                    <h3>Sistema de Login Completo</h3>
                    <div class="timebox">40 minutos</div>
                    <ol class="guided-steps">
                        <li>Instale o pacote <span class="inline-code">BCrypt.Net-Next</span></li>
                        <li>Crie o Model <span class="inline-code">Usuario</span> e adicione ao DbContext</li>
                        <li>Crie e aplique a migration</li>
                        <li>Crie o <span class="inline-code">ContaController</span> com Actions: Registrar (GET/POST) e Login (GET/POST)</li>
                        <li>No Registro, use <span class="inline-code">BCrypt.HashPassword()</span> para salvar a senha</li>
                        <li>No Login, use <span class="inline-code">BCrypt.Verify()</span> para validar</li>
                        <li>Grave o nome do usu√°rio na sess√£o ap√≥s login</li>
                        <li>Proteja o CRUD de Produtos ‚Äî redirecione para login se n√£o estiver logado</li>
                        <li>Implemente o Logout que limpa a sess√£o</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- SLIDE 13: Prepara√ß√£o -->
        <div class="slide slide-content">
            <div class="slide-header"><h2>Prepara√ß√£o para a Pr√≥xima Aula</h2></div>
            <div class="slide-body" style="justify-content: center;">
                <div class="box-preclass">
                    <h3>Atividade Pr√©-Aula (Obrigat√≥ria)</h3>
                    <p>Para a <strong>Aula 16 ‚Äî API REST com ASP.NET Core</strong>:</p>
                    <ol style="margin-top: 10px;">
                        <li>Pesquise o que √© uma <strong>API REST</strong></li>
                        <li>Leia sobre os <strong>verbos HTTP</strong> (GET, POST, PUT, DELETE) no contexto de APIs</li>
                        <li>Pesquise o que √© o <strong>Swagger</strong></li>
                        <li>Pense: como o app do Uber se comunica com o servidor?</li>
                    </ol>
                    <p style="margin-top: 15px;"><strong>Tempo estimado:</strong> 25 minutos</p>
                </div>
            </div>
        </div>

        <!-- SLIDE 14: Encerramento -->
        <div class="slide slide-cover">
            <h1>Obrigado!</h1>
            <h2>D√∫vidas?</h2>
            <p>jose.romualdo@uni9.pro.br</p>
            <p style="margin-top: 30px; font-size: 0.9em; color: rgba(255,255,255,0.5);">Aula 15 ‚Äî Autentica√ß√£o e Autoriza√ß√£o</p>
        </div>

    </div>
    <script src="js/slides.js"></script>
</body>
</html>
